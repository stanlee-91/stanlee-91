SQL_Coronavirus (COVID-19) Deaths & Vaccinations

SELECT *
FROM [dbo].[CovidDeaths]
WHERE continent is not null
ORDER BY [location], [date];

SELECT *
FROM [dbo] .[CovidVaccinations]
ORDER BY [location], [date];

SELECT location, date, total_cases, new_cases, total_deaths, population
FROM [dbo].[CovidDeaths];

--- Total cases Vs Total deaths

SELECT location, date, total_cases,total_deaths, (total_deaths/total_cases)*100 as deathpercentage
FROM [dbo].[CovidDeaths]
WHERE location like '%africa%'

--- Total cases Vs Population
----Shows what percentage of population was infected with Covid 

SELECT location, date, total_cases,population, (total_cases/population)*100 as percentpopulationinfected
FROM [dbo].[CovidDeaths]
--WHERE location like '%africa%'

--- Countries with highest infection rate compared to population

SELECT location,population, MAX(total_cases) as highestinfectioncount, Max ((total_cases/population))*100 as percentpopulationinfected
FROM [dbo].[CovidDeaths]
--WHERE location like '%africa%'
WHERE continent is not null
GROUP BY location,population
ORDER BY percentpopulationinfected desc

---- Countries with highest death count per population

SELECT location, MAX(cast(total_deaths as int)) as totaldeathcount
FROM [dbo].[CovidDeaths]
--WHERE location like '%africa%'
WHERE continent is not null
GROUP BY location
ORDER BY totaldeathcount desc

----Break down by Continent (Continents with the highest death count per population)-----------

SELECT continent, MAX(cast(total_deaths as int)) as totaldeathcount
FROM [dbo].[CovidDeaths]
--WHERE location like '%africa%'
WHERE continent is not null
GROUP BY continent
ORDER BY totaldeathcount desc

----- Correct Query to use going forward---------

--SELECT location, MAX(cast(total_deaths as int)) as totaldeathcount
--FROM [dbo].[CovidDeaths]
----WHERE location like '%africa%'
--WHERE continent is null
--GROUP BY location
--ORDER BY totaldeathcount desc


---- Global Numbers--------------

SELECT date, SUM(new_cases) as total_cases, SUM(cast(new_deaths as int)) as total_deaths,SUM(cast(new_deaths as int))/SUM(new_cases)*100 as deathpercentage
FROM [dbo].[CovidDeaths]
--WHERE location like '%africa%'
WHERE continent is not null
GROUP BY date
ORDER BY 1,2

-----Joining the Covid_deaths and Covid_Vaccinations---------

SELECT *
FROM [dbo] .[CovidDeaths] dea
join [dbo] .[CovidVaccinations] vac
   on dea.location = vac.location
      and dea.date = vac.date

------Total Population Vs Vaccinattions-------------

SELECT dea.continent, dea.location, dea.date, dea.population, vac.new_vaccinations
, SUM(cast (vac.new_vaccinations as int)) OVER (partition by dea.location ORDER BY dea.location, dea.date) as rollingpeoplevaccinated
FROM [dbo] .[CovidDeaths] dea
join [dbo] .[CovidVaccinations] vac
   on dea.location = vac.location
      and dea.date = vac.date
WHERE dea.continent is not null
ORDER BY 2,3

-----Use CTE-----------

with popvsVac (continent, location, date, population, new_vaccinations, rollingpeoeplevaccinated)
as
(
SELECT dea.continent, dea.location, dea.date, dea.population, vac.new_vaccinations
, SUM(cast (vac.new_vaccinations as int)) OVER (partition by dea.location ORDER BY dea.location, dea.date) as rollingpeoplevaccinated
FROM [dbo] .[CovidDeaths] dea
join [dbo] .[CovidVaccinations] vac
   on dea.location = vac.location
      and dea.date = vac.date
WHERE dea.continent is not null
--ORDER BY 2,3
)
SELECT *, (rollingpeoeplevaccinated/population)*100
FROM popvsVac
